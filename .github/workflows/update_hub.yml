name: Sync Wiki to Hub
on:
  push:
    branches: [ main ] 

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Wiki
        uses: actions/checkout@v3
        with:
          path: wiki

      - name: Checkout Hub
        uses: actions/checkout@v3
        with:
          repository: qtetech/qtetech.github.io
          token: ${{ secrets.GH_PAT }}
          path: hub

      - name: Update Hub README
        run: |
          cd wiki
          # Lá»‡nh find nÃ y sáº½ quÃ©t táº¥t cáº£ thÆ° má»¥c con Ä‘á»ƒ tÃ¬m file .md
          LIST=$(find . -name "*.md" ! -name "README.md" ! -path "*/.*" | sed 's|./||' | sort -r | head -n 15 | while read line; do
            # Láº¥y tÃªn file Ä‘á»ƒ hiá»ƒn thá»‹
            FILENAME=$(basename "$line")
            echo "- [$FILENAME](https://github.com/qtetech/qte-technologies-every-industrial-and-scientific-wiki/blob/main/$line)"
          done)
          
          cd ../hub
          # XÃ³a pháº§n cÅ© vÃ  ghi Ä‘Ã¨ pháº§n má»›i
          sed -i '/## ðŸ†• Latest Technical Updates:/,$d' README.md
          echo -e "## ðŸ†• Latest Technical Updates:\n" >> README.md
          echo "$LIST" >> README.md
          
          git config --global user.name "QTE-Bot"
          git config --global user.email "bot@qtetech.com"
          git add README.md
          git commit -m "Neural Update: Deep sync all articles" || echo "No changes"
          git push origin main
